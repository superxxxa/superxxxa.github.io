<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ™‚å…‰åµæ¢ï¼šå°‹æ‰¾å¤±è½çš„å°ç£ç¸£ç½²</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <style>
        #gameUI {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial;
            z-index: 999;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
        #clueNotification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,150,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        #gameIntro {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }
        #gameIntro h2 {
            color: #4CC3D9;
            text-align: center;
            margin-bottom: 20px;
        }
        #gameIntro ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        #gameIntro li {
            margin: 10px 0;
        }
        #startButton {
            display: block;
            margin: 20px auto 0;
            padding: 15px 30px;
            background: #4CC3D9;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        #startButton:hover {
            background: #3BA3B9;
        }
    </style>
</head>
<body>
    <!-- éŠæˆ²èªªæ˜ä»‹é¢ -->
    <div id="gameIntro">
        <h2>ğŸ•°ï¸ æ™‚å…‰åµæ¢ï¼šå°‹æ‰¾å¤±è½çš„å°ç£ç¸£ç½²</h2>
        <h3>ğŸ“– æ•…äº‹èƒŒæ™¯</h3>
        <p>2024å¹´ï¼Œå°å—å¸‚æ–‡åŒ–å±€åœ¨èµ¤å´æ–‡åŒ–åœ’å€ç™¼ç¾äº†ç¥ç§˜çš„æ­·å²éºæ§‹ã€‚ä½ å°‡æ‰®æ¼”æ™‚å…‰è€ƒå¤å­¸å®¶ï¼Œç©¿è¶Šä¸åŒæ™‚ä»£æ”¶é›†ç·šç´¢ï¼Œç¢ºèªé€™å°±æ˜¯å¤±è½å·²ä¹…çš„å°ç£ç¸£ç½²ï¼</p>
        
        <h3>ğŸ® æ“ä½œèªªæ˜</h3>
        <ul>
            <li><strong>ç§»å‹•ï¼š</strong>ä½¿ç”¨æ–æ¡¿æˆ–é»æ“Šåœ°é¢ç¬é–“å‚³é€</li>
            <li><strong>äº’å‹•ï¼š</strong>å°‡æ¸¸æ¨™å°æº–ç‰©ä»¶ï¼ŒæŒ‰ä¸‹æ‰³æ©Ÿéµ</li>
            <li><strong>è§€å¯Ÿï¼š</strong>é è¿‘ç‰©ä»¶æŸ¥çœ‹ç´°ç¯€</li>
            <li><strong>VRæ¨¡å¼ï¼š</strong>é»æ“Šå³ä¸‹è§’VRçœ¼é¡åœ–ç¤ºé€²å…¥</li>
        </ul>
        
        <h3>ğŸ¯ ä»»å‹™ç›®æ¨™</h3>
        <ul>
            <li>å ´æ™¯1ï¼šåœ¨è€ƒå¤ç¾å ´æ‰¾å‡ºçŸ³ç¢‘ä¸Šçš„å¹´ä»½ï¼ˆè»Œè·¡è§£è¬ï¼‰</li>
            <li>å ´æ™¯2ï¼šè§£è®€ç¸£ç½²å…§çš„è—é ­è©©</li>
            <li>å ´æ™¯3ï¼šç ´è§£æ•™å®¤é»‘æ¿ä¸Šçš„æ‘©æ–¯å¯†ç¢¼</li>
            <li>å ´æ™¯4ï¼šåœ¨3Dåœ°åœ–ä¸Šæ¨™è¨˜å‡ºç¸£ç½²çš„æ­£ç¢ºä½ç½®</li>
        </ul>
        
        <h3>â±ï¸ æ™‚é–“é™åˆ¶</h3>
        <p>ä½ æœ‰15åˆ†é˜çš„æ™‚é–“å®Œæˆæ‰€æœ‰ä»»å‹™ã€‚æ”¶é›†4å€‹ç·šç´¢ï¼Œæ­é–‹å°ç£ç¸£ç½²çš„ç§˜å¯†ï¼</p>
        
        <button id="startButton">é–‹å§‹éŠæˆ²</button>
    </div>
    
    <div id="gameUI" style="display: none;">
        <h3>æ™‚å…‰åµæ¢ï¼šå°‹æ‰¾å¤±è½çš„å°ç£ç¸£ç½²</h3>
        <p>å ´æ™¯: <span id="currentScene">è€ƒå¤ç¾å ´</span></p>
        <p>æ”¶é›†ç·šç´¢: <span id="clueCount">0</span>/4</p>
        <p>æ™‚é–“: <span id="timer">15:00</span></p>
    </div>
    
    <div id="clueNotification"></div>

    <a-scene environment="preset: japan; groundColor: #445; grid: cross">
        <!-- è³‡æºå®šç¾© -->
        <a-assets>
            <!-- å¯ä»¥åœ¨é€™è£¡åŠ å…¥åœ–ç‰‡æˆ–æ¨¡å‹è³‡æº -->
            <img id="mapTexture" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==" alt="map">
        </a-assets>

        <!-- ç›¸æ©Ÿèˆ‡æ§åˆ¶å™¨ -->
        <a-entity id="player" position="0 1.6 0">
            <a-camera>
                <a-cursor color="#4CC3D9"></a-cursor>
            </a-camera>
            <a-entity laser-controls="hand: right"></a-entity>
            <a-entity laser-controls="hand: left"></a-entity>
        </a-entity>

        <!-- å ´æ™¯1: è€ƒå¤ç¾å ´ -->
        <a-entity id="scene1" visible="true">
            <!-- è€ƒå¤å€åŸŸåœ°é¢ -->
            <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" 
                     color="#8B7355" roughness="0.8">
            </a-plane>
            
            <!-- çŸ³ç¢‘ (è»Œè·¡è§£è¬) -->
            <a-box id="stonePlate" position="-2 0.5 -4" width="1" height="1.5" depth="0.2"
                   color="#696969" class="clickable"
                   animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                   animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="è¿½è¹¤ç­†åŠƒ:\nä¸€å…­å…«å››" position="0 0 0.11" align="center" 
                        color="white" width="3"></a-text>
            </a-box>
            
            <!-- è€ƒå¤å·¥å…· -->
            <a-cylinder id="brush" position="1 0.1 -3" radius="0.05" height="0.3"
                        color="#8B4513" rotation="0 0 90" class="grabbable">
            </a-cylinder>
            
            <!-- 1875å¹´åœ°åœ– -->
            <a-image id="map1875" src="#mapTexture" position="3 2 -5" width="3" height="2"
                     class="clickable">
            </a-image>
            
            <!-- å ´æ™¯èªªæ˜ç‰Œ -->
            <a-text value="è€ƒå¤ç¾å ´\næ‰¾å‡ºçŸ³ç¢‘ä¸Šçš„å¹´ä»½ç·šç´¢" position="0 3 -4" 
                    align="center" color="white" width="6">
            </a-text>
        </a-entity>

        <!-- å ´æ™¯2: æ¸…æœç¸£ç½² -->
        <a-entity id="scene2" visible="false">
            <!-- ç¸£ç½²å»ºç¯‰ -->
            <a-box position="0 2 -6" width="8" height="4" depth="6" color="#8B4513">
                <a-text value="å°ç£ç¸£ç½²" position="0 2.1 3.01" align="center" 
                        color="gold" width="10"></a-text>
            </a-box>
            
            <!-- è—é ­è©©ç‰ŒåŒ¾ -->
            <a-plane id="poemBoard" position="0 2 -2.9" width="3" height="2" color="#333"
                     class="clickable">
                <a-text value="å°å³¶åˆè¨­åºœ\nç£å²¸ç¯‰æ–°åŸ\nç¸£å®˜ç†æ°‘äº‹\nç½²å…§åˆ¤å…¬æ˜" 
                        position="0 0 0.01" align="center" color="white" width="4"
                        line-height="60"></a-text>
            </a-plane>
            
            <!-- å®˜å“¡NPC -->
            <a-cylinder position="-2 1 -4" radius="0.3" height="2" color="#4169E1">
                <a-sphere position="0 1.2 0" radius="0.3" color="#FDBCB4"></a-sphere>
            </a-cylinder>
        </a-entity>

        <!-- å ´æ™¯3: æ—¥æ²»æ™‚æœŸ -->
        <a-entity id="scene3" visible="false">
            <!-- æ•™å®¤ -->
            <a-box position="0 2 -5" width="6" height="3" depth="5" color="#F5DEB3"
                   opacity="0.8">
            </a-box>
            
            <!-- é»‘æ¿ (æ‘©æ–¯å¯†ç¢¼) -->
            <a-plane id="blackboard" position="0 2 -2.4" width="4" height="2" color="#2F4F2F"
                     class="clickable">
                <a-text value="å¯†ç¢¼ï¼š\n-.-. .... .. -.- .- -.\n(CHIKAN)" 
                        position="0 0 0.01" align="center" color="white" width="5"></a-text>
            </a-plane>
            
            <!-- èª²æ¡Œæ¤… -->
            <a-box position="-1 0.5 -3" width="0.8" height="0.8" depth="0.6" 
                   color="#8B4513"></a-box>
            <a-box position="1 0.5 -3" width="0.8" height="0.8" depth="0.6" 
                   color="#8B4513"></a-box>
        </a-entity>

        <!-- å ´æ™¯4: æ™‚ç©ºæ•´åˆå®¤ -->
        <a-entity id="scene4" visible="false">
            <!-- 3Dåœ°åœ–å¹³å° -->
            <a-cylinder position="0 0.5 -4" radius="3" height="0.2" color="#1E90FF"
                        opacity="0.7">
            </a-cylinder>
            
            <!-- èµ¤å´æ¨“æ¨¡å‹ -->
            <a-box position="0 1 -4" width="1" height="0.8" depth="1" color="#DC143C">
                <a-text value="èµ¤å´æ¨“" position="0 0.5 0" align="center" 
                        color="white" width="3"></a-text>
            </a-box>
            
            <!-- ç¸£ç½²ä½ç½®æ¨™è¨˜ (éœ€è¦ç©å®¶æ”¾ç½®) -->
            <a-sphere id="countyMarker" position="2 1 -3" radius="0.2" color="#FFD700"
                      class="grabbable">
                <a-text value="ç¸£ç½²" position="0 0.3 0" align="center" 
                        color="white" width="2"></a-text>
            </a-sphere>
            
            <!-- æœ€çµ‚ç¢ºèªæŒ‰éˆ• -->
            <a-box id="confirmButton" position="0 1.5 -2" width="2" height="0.5" depth="0.1"
                   color="#32CD32" class="clickable">
                <a-text value="ç¢ºèªä½ç½®" position="0 0 0.06" align="center" 
                        color="white" width="5"></a-text>
            </a-box>
        </a-entity>

        <!-- é¡å¤–å…‰æºå¢åŠ äº®åº¦ -->
        <a-light type="ambient" color="#FFF" intensity="0.3"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.4" position="-0.5 1 1"></a-light>
    </a-scene>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            currentScene: 1,
            cluesFound: 0,
            timeRemaining: 900, // 15åˆ†é˜
            clues: {
                year1684: false,
                taiwanCounty: false,
                chikan: false,
                location: false
            }
        };

        let timerInterval;
        let gameStarted = false;

        // ç¢ºä¿ A-Frame å®Œå…¨è¼‰å…¥å¾Œå†åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾… A-Frame åˆå§‹åŒ–
            if (typeof AFRAME === 'undefined') {
                console.log('ç­‰å¾… A-Frame è¼‰å…¥...');
                // å¦‚æœ AFRAME é‚„æœªå®šç¾©ï¼Œç­‰å¾…ä¸€ä¸‹å†è©¦
                setTimeout(function() {
                    initializeGame();
                }, 1000);
            } else {
                initializeGame();
            }
        });

        function initializeGame() {
            // ç°¡å–®çš„æŠ“å–åŠŸèƒ½
            AFRAME.registerComponent('grabbable', {
                init: function() {
                    this.el.addEventListener('click', function(evt) {
                        // ç°¡åŒ–ç‰ˆï¼šé»æ“Šå¾Œè·Ÿéš¨ç›¸æ©Ÿç§»å‹•
                        console.log('ç‰©ä»¶è¢«æŠ“å–');
                    });
                }
            });

            // ç¶å®šé–‹å§‹æŒ‰éˆ•
            document.getElementById('startButton').addEventListener('click', startGame);

            console.log('éŠæˆ²åˆå§‹åŒ–å®Œæˆï¼');
        }

        function startGame() {
            // éš±è—èªªæ˜ä»‹é¢
            document.getElementById('gameIntro').style.display = 'none';
            // é¡¯ç¤ºéŠæˆ²UI
            document.getElementById('gameUI').style.display = 'block';
            
            gameStarted = true;

            // ç¶å®šæ‰€æœ‰äº’å‹•äº‹ä»¶
            setupEventListeners();

            // å•Ÿå‹•è¨ˆæ™‚å™¨
            startTimer();

            console.log('éŠæˆ²é–‹å§‹ï¼');
        }

        function setupEventListeners() {
            // äº’å‹•äº‹ä»¶
            document.getElementById('stonePlate').addEventListener('click', function() {
                collectClue('year1684');
            });

            document.getElementById('poemBoard').addEventListener('click', function() {
                collectClue('taiwanCounty');
            });

            document.getElementById('blackboard').addEventListener('click', function() {
                collectClue('chikan');
            });

            document.getElementById('confirmButton').addEventListener('click', function() {
                // æª¢æŸ¥ç¸£ç½²æ¨™è¨˜æ˜¯å¦åœ¨æ­£ç¢ºä½ç½®
                const marker = document.getElementById('countyMarker');
                const markerPos = marker.getAttribute('position');
                
                // ç°¡åŒ–åˆ¤å®šï¼šåªè¦ç§»å‹•äº†æ¨™è¨˜å°±ç®—æ­£ç¢º
                if (markerPos.x > 0.5 && markerPos.z < -3.5) {
                    collectClue('location');
                    endGame(true);
                } else {
                    showNotification('ä½ç½®ä¸æ­£ç¢ºï¼Œè«‹å†è©¦è©¦çœ‹ï¼');
                }
            });
        }

        function startTimer() {
            // è¨ˆæ™‚å™¨
            timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                updateTimer();
                if (gameState.timeRemaining <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        function updateTimer() {
            const minutes = Math.floor(gameState.timeRemaining / 60);
            const seconds = gameState.timeRemaining % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // ç·šç´¢æ”¶é›†
        function collectClue(clueName) {
            if (!gameState.clues[clueName]) {
                gameState.clues[clueName] = true;
                gameState.cluesFound++;
                document.getElementById('clueCount').textContent = gameState.cluesFound;
                showNotification(`ç™¼ç¾ç·šç´¢ï¼š${getClueText(clueName)}`);
                
                // æª¢æŸ¥æ˜¯å¦å¯ä»¥é€²å…¥ä¸‹ä¸€å ´æ™¯
                checkSceneProgress();
            }
        }

        function getClueText(clueName) {
            const clueTexts = {
                year1684: '1684å¹´ - å°ç£è¨­åºœä¹‹å¹´',
                taiwanCounty: 'å°ç£ç¸£ç½²',
                chikan: 'èµ¤å´ (CHIKAN)',
                location: 'ç¸£ç½²ä½æ–¼èµ¤å´æ¨“æ±åŒ—å´'
            };
            return clueTexts[clueName] || clueName;
        }

        function showNotification(text) {
            const notification = document.getElementById('clueNotification');
            notification.textContent = text;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // å ´æ™¯åˆ‡æ›
        function switchScene(sceneNum) {
            // éš±è—æ‰€æœ‰å ´æ™¯
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`scene${i}`).setAttribute('visible', false);
            }
            // é¡¯ç¤ºç›®æ¨™å ´æ™¯
            document.getElementById(`scene${sceneNum}`).setAttribute('visible', true);
            gameState.currentScene = sceneNum;
            
            // æ›´æ–°UI
            const sceneNames = ['', 'è€ƒå¤ç¾å ´', 'æ¸…æœç¸£ç½²', 'æ—¥æ²»æ™‚æœŸ', 'æ™‚ç©ºæ•´åˆå®¤'];
            document.getElementById('currentScene').textContent = sceneNames[sceneNum];
        }

        function checkSceneProgress() {
            if (gameState.currentScene === 1 && gameState.clues.year1684) {
                setTimeout(() => switchScene(2), 2000);
            } else if (gameState.currentScene === 2 && gameState.clues.taiwanCounty) {
                setTimeout(() => switchScene(3), 2000);
            } else if (gameState.currentScene === 3 && gameState.clues.chikan) {
                setTimeout(() => switchScene(4), 2000);
            }
        }

        // éŠæˆ²çµæŸ
        function endGame(success) {
            if (!gameStarted) return;
            
            clearInterval(timerInterval);
            if (success) {
                showNotification('æ­å–œï¼ä½ æˆåŠŸæ‰¾åˆ°äº†å°ç£ç¸£ç½²çš„ä½ç½®ï¼');
                // é¡¯ç¤ºç¸£ç½²é‡å»ºå‹•ç•«
                setTimeout(() => {
                    const message = `
                        ğŸ‰ ä»»å‹™å®Œæˆï¼
                        
                        å°ç£ç¸£ç½²å°±ä½æ–¼èµ¤å´æ¨“æ±åŒ—å´ï¼Œç´„åœ¨ä»Šæ—¥æˆåŠŸåœ‹å°é™„è¿‘ã€‚
                        
                        æ­·å²å°çŸ¥è­˜ï¼š
                        - 1684å¹´ï¼šæ¸…æœè¨­ç«‹å°ç£åºœï¼Œå°ç£ç¸£ç‚ºå…¶è½„ä¸‹ä¸‰ç¸£ä¹‹ä¸€
                        - ç¸£ç½²åŠŸèƒ½ï¼šè™•ç†åœ°æ–¹è¡Œæ”¿ã€å¸æ³•ç­‰äº‹å‹™
                        - 1887å¹´ï¼šå°ç£å»ºçœå¾Œï¼Œç¸£ç½²åŠŸèƒ½é€æ¼¸æ”¹è®Š
                        
                        æ„Ÿè¬ä½ å”åŠ©æ‰¾å›é€™æ®µé‡è¦çš„æ­·å²è¨˜æ†¶ï¼
                    `;
                    alert(message);
                }, 3000);
            } else {
                alert('â° æ™‚é–“åˆ°ï¼è«‹å†æ¥å†å²ï¼\n\næç¤ºï¼šä»”ç´°è§€å¯Ÿæ¯å€‹å ´æ™¯ä¸­çš„ç·šç´¢ç‰©ä»¶ã€‚');
            }
        }
    </script>
</body>
</html>
